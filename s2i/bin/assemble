#!/bin/bash

### Passos pra Instalacao do OCI
INSTALL_PKGS_DEVEL="rh-php$(echo $PHP_VERSION | tr -cd '[[:digit:]]')-php-devel"
yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS_DEVEL --nogpgcheck

echo "Instalando dependÃªncias ORACLE 18.5"
rpm -ivh http://repositoriocentos.intra.goias.gov.br/oracle/oracle-instantclient18.5-basic-18.5.0.0.0-3.x86_64.rpm
rpm -ivh http://repositoriocentos.intra.goias.gov.br/oracle/oracle-instantclient18.5-devel-18.5.0.0.0-3.x86_64.rpm

echo "/usr/lib/oracle/18.5/client64/lib" > /etc/ld.so.conf.d/oracle.conf
#https://pecl.php.net/package/oci8
#oci8-2.0.12
echo 'instantclient,/usr/lib/oracle/18.5/client64/lib' | pecl install ${OCI8_VERSION}

echo 'extension=oci8.so' >> /etc/opt/rh/rh-php$(echo $PHP_VERSION | tr -cd '[[:digit:]]')/php.d/10-oci8.ini

# Continua a os scripts de build do S2i
/usr/libexec/s2i/assemble
rc=$?

if [ $rc -eq 0 ]; then
echo "After successful assembling"
else
echo "After failed assembling"
fi

exit $rc
